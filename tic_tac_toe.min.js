let board=[[" "," "," "],[" "," "," "],[" "," "," "]],currentPlayer="X",gameWon=!1,gameDraw=!1,inputCorrect=!0,fieldFilled=!1,movesCounter=0,inputCounter=0,showScore=!1,showRules=!1,xWon=0,oWon=0,endedDraw=0,rules='We play the game with the official rules and no modifications:\n- X places its mark first in the first round\n- The looser of the last game starts the game, which is then\n- played in an endless alternating order\n- Players must mark its position within the nine spaces\n- The first player to get 3 of her marks in a row (up, down,\n- across, or diagonally) is the winner\n- When all 9 squares are full, the game is over. If no player has 3\n- marks in a row, the game ends in a tie. X starts the next game\n\nKeycode:\n"r" = show rules\n"p" = show stats\n"e" = end the game';const readline=require("readline"),rl=readline.createInterface({input:process.stdin,output:process.stdout});function playGame(){firstRound(),rl.question(currentPlayer+": Please enter the position of your mark (Row:Column):",e=>{if(!showScore&&(checkInput(e),inputCorrect)){updateBoard(e[0]-1,e[2]-1),fieldFilled||(printBoard(),checkWinAndDraw(),gameLoop())}})}function firstRound(){0===movesCounter&&0===inputCounter&&(console.clear(),console.log('If you want to look up the rules, you can press "r" during the game to show them.'),inputCounter++,printBoard())}function printBoard(){console.log(" "),console.log("  "+board[0][0]+" | "+board[0][1]+" | "+board[0][2]),console.log(" -----------"),console.log("  "+board[1][0]+" | "+board[1][1]+" | "+board[1][2]),console.log(" -----------"),console.log("  "+board[2][0]+" | "+board[2][1]+" | "+board[2][2]),console.log(" ")}function checkInput(e){checkInputLength(e),inputCorrect&&checkInputFormat(e)}function checkInputLength(e){3!==e.length?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):inputCorrect=!0}function checkInputFormat(e){1!=e[0]&&2!=e[0]&&3!=e[0]?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):1!=e[2]&&2!=e[2]&&3!=e[2]?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):":"!=e[1]?(console.clear(),console.error('The inserted field is not valid. Try again:\n        Example: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):inputCorrect=!0}function checkWinAndDraw(){checkWin(),checkDraw()}function checkWin(){for(let e=0;e<3;e++){if(board[e][0]===board[e][1]&&board[e][1]===board[e][2]&&" "!==board[e][0])return void(gameWon=!0);if(board[0][e]===board[1][e]&&board[1][e]===board[2][e]&&" "!==board[0][e])return void(gameWon=!0)}(board[0][0]!==board[1][1]||board[1][1]!==board[2][2]||" "===board[0][0])&&(board[0][2]!==board[1][1]||board[1][1]!==board[2][0]||" "===board[0][2])||(gameWon=!0)}function checkDraw(){9!==++movesCounter||gameWon||(gameDraw=!0)}function updateBoard(e,o){console.clear()," "!=board[e][o]?(console.clear(),console.error("The inserted field is already taken. Try again:"),fieldFilled=!0,printBoard(),playGame()):(fieldFilled=!1,board[e][o]=currentPlayer)}function gameLoop(){gameWon||gameDraw?!gameWon&&gameDraw?(updateStats(),newGame(`The game ended in a draw.\nStats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}                        \nDo you want to start a new game (Press "Enter")? `)):(updateStats(),newGame(`${currentPlayer}: Won the game. \nStats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}\nDo you want to start a new game? (Press "Enter")`)):(switchPlayer(),playGame())}function switchPlayer(){currentPlayer="X"===currentPlayer?"O":"X"}function updateStats(){gameWon?"X"===currentPlayer?xWon++:oWon++:gameDraw&&!gameWon&&endedDraw++}function newGame(e){rl.question(e,()=>{resetEverything(),playGame()})}function resetEverything(){gameWon=!1,gameDraw=!1,switchPlayer(),console.clear(),movesCounter=0,inputCounter=0,board=[[" "," "," "],[" "," "," "],[" "," "," "]]}playGame(),readline.emitKeypressEvents(process.stdin),process.stdin.on("keypress",e=>{"p"===e?(showScore=!0,console.clear(),console.log(`Stats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}\nPress "Enter" to continue`)):"\r"===e&&showScore&&(showScore=!1,console.clear(),rl.clearLine(-1),printBoard(),playGame()),"r"===e?(showScore=!0,console.clear(),console.log(`${rules}\n\nPress "Enter" to continue`)):"\r"===e&&showRules?(showRules=!1,console.clear(),rl.clearLine(-1),printBoard(),playGame()):"e"===e&&process.exit()});