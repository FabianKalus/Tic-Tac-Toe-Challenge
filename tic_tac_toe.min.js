let coordinatColumn,coordinatRow,board=[[" "," "," "],[" "," "," "],[" "," "," "]],currentPlayer="X",gameWon=!1,gameDraw=!1,inputCorrect=!0,fieldFilled=!1,movesCounter=0,inputCounter=0,showScore=!1,showRules=!1,xWon=0,oWon=0,endedDraw=0,gameVSComputer=!1,computerDidTurn=!1,rules='We play the game with the official rules and no modifications:\n- X places its mark first in the first round\n- The looser of the last game starts the game, which is then\n- played in an endless alternating order\n- Players must mark its position within the nine spaces\n- The first player to get 3 of her marks in a row (up, down,\n- across, or diagonally) is the winner\n- When all 9 squares are full, the game is over. If no player has 3\n- marks in a row, the game ends in a tie. X starts the next game\n\nKeycode:\n"r" = show rules\n"p" = show stats\n"e" = end the game';const readline=require("readline"),rl=readline.createInterface({input:process.stdin,output:process.stdout});function chooseOpponent(){console.clear(),rl.question("You want to play against a computer (c) or a human (h):",o=>{"c"===o?(gameVSComputer=!0,playVsComputer()):"h"===o?(gameVSComputer=!1,playGame()):(console.clear(),chooseOpponent())})}function playGame(){firstRound(),"O"===currentPlayer&&!0===gameVSComputer?playVsComputer():rl.question(currentPlayer+": Please enter the position of your mark (Row:Column):",o=>{if(!showScore&&(checkInput(o),inputCorrect)){updateBoard(o[0]-1,o[2]-1),fieldFilled||(printBoard(),checkWinAndDraw(),gameLoop())}})}function firstRound(){0===movesCounter&&0===inputCounter&&(console.clear(),console.log('If you want to look up the rules, you can press "r" during the game to show them.'),inputCounter++,printBoard())}function printBoard(){console.log(" "),console.log("  "+board[0][0]+" | "+board[0][1]+" | "+board[0][2]),console.log(" -----------"),console.log("  "+board[1][0]+" | "+board[1][1]+" | "+board[1][2]),console.log(" -----------"),console.log("  "+board[2][0]+" | "+board[2][1]+" | "+board[2][2]),console.log(" ")}function checkInput(o){checkInputLength(o),inputCorrect&&checkInputFormat(o)}function checkInputLength(o){3!==o.length?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):inputCorrect=!0}function checkInputFormat(o){1!=o[0]&&2!=o[0]&&3!=o[0]?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):1!=o[2]&&2!=o[2]&&3!=o[2]?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):":"!=o[1]?(console.clear(),console.error('The inserted field is not valid. Try again:\nExample: "2:2" places the X in the  middle center field'),inputCorrect=!1,printBoard(),playGame()):inputCorrect=!0}function checkWinAndDraw(){checkWin(),checkDraw()}function checkWin(){for(let o=0;o<3;o++){if(board[o][0]===board[o][1]&&board[o][1]===board[o][2]&&" "!==board[o][0])return void(gameWon=!0);if(board[0][o]===board[1][o]&&board[1][o]===board[2][o]&&" "!==board[0][o])return void(gameWon=!0)}(board[0][0]!==board[1][1]||board[1][1]!==board[2][2]||" "===board[0][0])&&(board[0][2]!==board[1][1]||board[1][1]!==board[2][0]||" "===board[0][2])||(gameWon=!0)}function checkDraw(){9!==++movesCounter||gameWon||(gameDraw=!0)}function updateBoard(o,e){console.clear()," "!=board[o][e]?(console.clear(),console.error("The inserted field is already taken. Try again:"),fieldFilled=!0,printBoard(),playGame()):(fieldFilled=!1,board[o][e]=currentPlayer)}function gameLoop(){gameWon||gameDraw?!gameWon&&gameDraw?(updateStats(),newGame(`The game ended in a draw.\nStats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}                        \nDo you want to start a new game (Press "Enter")? `)):(updateStats(),newGame(`${currentPlayer}: Won the game. \nStats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}\nDo you want to start a new game? (Press "Enter")`)):(switchPlayer(),playGame())}function switchPlayer(){currentPlayer="X"===currentPlayer?"O":"X"}function updateStats(){gameWon?"X"===currentPlayer?xWon++:oWon++:gameDraw&&!gameWon&&endedDraw++}function newGame(o){rl.question(o,()=>{resetEverything(),playGame()})}function resetEverything(){gameWon=!1,gameDraw=!1,computerDidTurn=!1,switchPlayer(),console.clear(),movesCounter=0,inputCounter=0,board=[[" "," "," "],[" "," "," "],[" "," "," "]]}function playVsComputer(){gameVSComputer=!0,"X"===currentPlayer?playGame():(computerDidTurn=!1,computerWinandLose("O"),computerDidTurn||computerWinandLose("X"),computerDidTurn||creatRandomCoordinats(),fieldFilled||(printBoard(),checkWinAndDraw(),gameLoop()))}function creatRandomCoordinats(){coordinatRow=Math.floor(3*Math.random()),coordinatColumn=Math.floor(3*Math.random())," "!==board[coordinatRow][coordinatColumn]?creatRandomCoordinats():updateBoard(coordinatRow,coordinatColumn)}function computerWinandLose(o){for(let e=0;e<3;e++)checkHorizontal(e,o),checkVertical(e,o);checkDiagonal(o)}function checkHorizontal(o,e){return board[o][0]!==e||board[o][2]!==e||" "!==board[o][1]||computerDidTurn?board[o][0]!==e||board[o][1]!==e||" "!==board[o][2]||computerDidTurn?board[o][1]!==e||board[o][2]!==e||" "!==board[o][0]||computerDidTurn?void 0:(updateBoard(o,0),void(computerDidTurn=!0)):(updateBoard(o,2),void(computerDidTurn=!0)):(updateBoard(o,1),void(computerDidTurn=!0))}function checkVertical(o,e){return board[0][o]!==e||board[2][o]!==e||" "!==board[1][o]||computerDidTurn?board[0][o]!==e||board[1][o]!==e||" "!==board[2][o]||computerDidTurn?board[1][o]!==e||board[2][o]!==e||" "!==board[0][o]||computerDidTurn?void 0:(updateBoard(0,o),void(computerDidTurn=!0)):(updateBoard(2,o),void(computerDidTurn=!0)):(updateBoard(1,o),void(computerDidTurn=!0))}function checkDiagonal(o){return board[0][0]!==o||board[1][1]!==o||" "!==board[2][2]||computerDidTurn?board[0][0]!==o||board[2][2]!==o||" "!==board[1][1]||computerDidTurn?board[1][1]!==o||board[2][2]!==o||" "!==board[0][0]||computerDidTurn?board[0][2]!==o||board[2][0]!==o||" "!==board[1][1]||computerDidTurn?board[1][1]!==o||board[2][0]!==o||" "!==board[0][2]||computerDidTurn?board[1][1]!==o||board[0][2]!==o||" "!==board[2][0]||computerDidTurn?void 0:(updateBoard(2,0),void(computerDidTurn=!0)):(updateBoard(0,2),void(computerDidTurn=!0)):(updateBoard(1,1),void(computerDidTurn=!0)):(updateBoard(0,0),void(computerDidTurn=!0)):(updateBoard(1,1),void(computerDidTurn=!0)):(updateBoard(2,2),void(computerDidTurn=!0))}chooseOpponent(),readline.emitKeypressEvents(process.stdin),process.stdin.on("keypress",o=>{"p"===o?(showScore=!0,console.clear(),console.log(`Stats: X-wins: ${xWon}, O-wins: ${oWon}, draw: ${endedDraw}\nPress "Enter" to continue`)):"\r"===o&&showScore&&(showScore=!1,console.clear(),rl.clearLine(-1),printBoard(),playGame()),"r"===o?(showScore=!0,console.clear(),console.log(`${rules}\n\nPress "Enter" to continue`)):"\r"===o&&showRules?(showRules=!1,console.clear(),rl.clearLine(-1),printBoard(),playGame()):"e"===o&&process.exit()});